# OSINT ja Proxeja

Tällä viikolla käsiteltiin avoimia tiedustelulähteitä, ja man-in-the middle proxy testausta.

## A/B) ZAP

Aluksi piti asentaa ja testata OWASP ZAP -proxyohjelmisto. ZAP:ia käytetään web-applikaatioden liikenteen skannaamiseen PenTestaus mielessä.

OWASP ZAP:n [omilta sivuilta](https://www.zaproxy.org/download/) löytynyt linuxin asennuspaketti ei jostain syystä toiminut Kali VM:lläni, mutta nopea tutkiminen johdatti minut sivulle [https://www.kali.org/tools/zaproxy/](https://www.kali.org/tools/zaproxy/), josta selvisi nopeasti, että ohjelman saa ladattua Kaliin paketinhallinnalla pakettinimellä zaproxy. Eli syötin terminaaliin vain komennon ``sudo apt install zaproxy``.

![image](https://user-images.githubusercontent.com/94109769/203083778-a778574d-426d-4f5d-ab05-49dbc9d32772.png)

Yllä oleva viesti pomppasi itselleni vastaan ensimmäisen kerjan ZAPin avatessani. Itselläni oli [quick start guide](https://www.zaproxy.org/getting-started/) tälle ohjelmalle toisella monitorilla auki, ja sain sieltä varmistettua, että tämän tarkoitus on asettaa tiedostosijainti sessioiden ja lokien tallentamiselle. Nyt tässä vaiheessa en halunnut mitään alkaa tallentelemaan, joten valitsin vain 'No' vaihtoehdon.

Tässä vaiheessa piti tehtävänannon mukaan myös tarkistaa, saako liikennettä näkymään tämän proxy:n kautta, mutta itselläni tuli mieleen tämän kokeilun laillisuus. Pelkästään googlettamisella en saanut satavarmaa vastausta siihen, voinko käyttä ZAP-proxya julkisilla sivuilla laillisesti, joten päätin konfiguroida itselleni nopeasti Ubuntu VM:n, jossa käy Apache2 weppipalvelin ja aika paljas oletus-sivu joka on https-salattu.

ZAP:sta löytyi myös pikakomento, jolla voi avatta esi-konfiguroidun Firefox ikkunan joka käyttää ZAP:ia proxyna, joten käytin suosiolla sitä. Tätä kautta tuli vastaan myös aloitussivu, joka kertoi, että tämä selainsessio oli konfiguroitu myös hyppäämään sertifikaatti-varoitusten ohitse.

![image](https://user-images.githubusercontent.com/94109769/204086141-fa036b27-9d25-4a78-8218-427d0dc06a35.png)

Ja tätä proxitettua selainta käyttämällä hyppäsin ubuntu-palvelimen pyörittämälle sivulle, ja sieltä näkyikin liikennettä.

![image](https://user-images.githubusercontent.com/94109769/204089554-6efb24f0-5b1b-4f56-bccb-68ded77e267c.png)

Koska sivu oli Apachen oletussivu vain, ei täältä saanut valitettavasti kauhean paljon muuta irti kuin toimivuuden demoamista varten. Tämä GET-pyynnön vastauspaketti saatiin kyllä avattua myös, ja siellä se näkyi puhtaasti HTTP-tekstinä, vaikka sivu oli HTTPS-muodossa. Huomasin myös, kun avasin sivun turvallisuustietoja proxitetusta firefox-selaimsesta, että sivu oli merkitty salatuksi, ja siellä näkyi nyt palvelimella itse-allekirjoitetun ssl-sertifikaatin sijaan owasp:n sertifikaatti:

![image](https://user-images.githubusercontent.com/94109769/204089640-3ea2f0d8-3349-445d-9647-39e939d61979.png)

## C/D) MITMPROXY

mitmproxy oli Kali-VM:llä asennettuna jo valmiiksi, mutta en osannut käyttää sitä puhtaalta pöydältä. Tähän löytyi avuksi [Hussein Nasserin opetusvideo](https://www.youtube.com/watch?v=7BXsaU42yok); video oli kyllä tehty MAC-käyttöympäristöä silmälläpitäen, mutta sain sovellettua kuitenkin sen pohjalta.

Ajamalla siis komennon ``mitmproxy`` komentorivillä mitm proxypalvelin ja sen konsoli-ikkuna aukesi. Tällä nyt itsestään ei tee mitään, mutta oman työpaikkani ympäristöstä tunnen, että Firefoxiin voi määritellä proxypalvelimen (Settings > Network Settings > Configure Proxy Access to the Internet).

![image](https://user-images.githubusercontent.com/94109769/204090670-a3c4e288-2cfc-4248-b43d-dc3dc96c151c.png)

Nyt kun yritin yhdistää Ubuntu-palvelimen sivulle, tuli Firefoxilta varoitusviesti.

![image](https://user-images.githubusercontent.com/94109769/204090770-37810802-bcd5-4561-8100-f966dd6442ea.png)

Tämä tietenkin varoittaa ei-luotettavasta sertifikaatista. Näitäkin olisi varmasti tullut näkyviin ZAP:ia käyttäessä, jos sen kautta käynnistetty selainsivu ei olisi automaattisesti hypännyt näiden ohi. Hyppäsin nyt tämän ohitse manuaalisesta valitsemalla Advanced > Accept the Risk and Continue.

![image](https://user-images.githubusercontent.com/94109769/204090824-c29f6dc6-2f14-4c6d-a347-63d13c9f58d5.png)

Tätähän nyt ei varmaan pitänyt käydä. Vai pitikö? Katseltuani Husseinin videota vielä eteenpäin, samanlainen tapaus kävi hänelläkin, koska sertifikaatti onkin nyt mitmproxy:n tarjoama, eikä sivuston. Tämä sama asetelma oli kyllä tpaahtunut ZAP:n kanssa, mutta oletettavasti OWASP:n allekirjoittama sertifikaatti, joka silloin tuli käyttöön, ei todennäköisesti luetu itse-allekirjoitetuksi, joten silloin se kuitenkin meni lävitse. Hieman eteenpäin videota katsottua neuvottiin kirjoittamaan selaimen osoitekenttään ``mitm.it``. Tämä avaa mitm:n selain-käyttöliittymän. Tämä näyttää ehkä julkiselta sivunimeltä, mutta se onkin mitmproxy-palvelimen paikallisesti ylläpitämä, joten sain sen silti auki vaikka kali-koneellani ei tällä hetkellä ollut yhteyttä internettiin suuntaavaan verkkoon.

![image](https://user-images.githubusercontent.com/94109769/204091672-d43927c9-3b28-46e7-b2a3-06e205029e7e.png)

Latasin tästä nyt linuxia varten tämän sertifikaattitiedoston (nämäkin ilmeisesti oletettavasti saatavilla jo valmiiksi paikallispalvelimella) ja tästä samalla löytyvien ohjeiden avulla otin sen käyttöön siirtämällä ensin juuri ladatun tiedoston polkuun /usr/local/share/ca-certificates/, ja ajamalla tämän jälkeen komennon ``sudo update-ca-certificates``.

![image](https://user-images.githubusercontent.com/94109769/204091964-6fdd38b4-9242-46ff-b2ba-cca92085bf4b.png)

Tämän jälkeen yritin taas yhdistään ubuntu-koneen sivulle, mutta sama virheviesti ilmestyi edelleen. En löytänyt mitään muita ohjeita, jotka viittaisivat johonkin muuhun tapaan ratkaista tämä ongelma, joten tehtävä taisi tyssätä tähän.


